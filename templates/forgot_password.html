<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forgot Password</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fstyle.css') }}">
</head>
<body>

    <div class="container">
        <h2>Reset Your Password</h2>

        <!-- Step 1: Enter Phone Number -->
        <div id="phone-step">
            <label for="phone">Enter your phone number:</label>
            <input type="text" id="phone" required>
            <button onclick="sendOTP()">Send OTP</button>
            <p id="message"></p>
        </div>

        <!-- Step 2: Enter OTP (Initially Hidden) -->
        <div id="otp-step" style="display: none;">
            <label for="otp">Enter OTP sent to your registered email:</label>
            <input type="text" id="otp" required>
            <button onclick="verifyOTP()">Verify OTP</button>
            <p id="otp-message"></p>
        </div>

        <!-- Step 3: Reset Password (Initially Hidden) -->
        <div id="password-step" style="display: none;">
            <label for="new-password">New Password:</label>
            <input type="password" id="new-password" required><br>

            <label for="confirm-password">Confirm Password:</label>
            <input type="password" id="confirm-password" required> <br>

            <button onclick="resetPassword()">Reset Password</button>
            <p id="password-message"></p>
        </div>
    </div>

    <script>
        function sendOTP() {
            let phone = document.getElementById("phone").value;
            fetch("/send_otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ phone: phone })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("message").innerText = data.message;
                if (data.success) {
                    document.getElementById("phone-step").style.display = "none";
                    document.getElementById("otp-step").style.display = "block";
                }
            });
        }

        function verifyOTP() {
            let otp = document.getElementById("otp").value;
            fetch("/verify_otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ otp: otp })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("otp-message").innerText = data.message;
                if (data.success) {
                    document.getElementById("otp-step").style.display = "none";
                    document.getElementById("password-step").style.display = "block";
                }
            });
        }

        function resetPassword() {
            let newPassword = document.getElementById("new-password").value;
            let confirmPassword = document.getElementById("confirm-password").value;
            if (newPassword !== confirmPassword) {
                document.getElementById("password-message").innerText = "Passwords do not match!";
                return;
            }
            fetch("/reset_password", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ password: newPassword })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("password-message").innerText = data.message;
                if (data.success) {
                    setTimeout(() => {
                        window.location.href = "/login";
                    }, 2000);
                }
            });
        }
    </script>

</body>
</html>
